#!/usr/bin/env bash
wget -cO /tmp/licenses.zip http://data.fcc.gov/download/license-view/fcc-license-view-data-csv-format.zip
gunzip -c /tmp/licenses.zip > /tmp/licenses.csv
# Rather than insert every damn row into the import table, first do a quick filter.
awk 'NR==1 || /Amateur/' /tmp/licenses.csv > /tmp/amateur_licenses.csv
psql $DATABASE_URL -c "DROP TABLE IF EXISTS import.amateur_licenses"
/app/bin/pgfutter_linux --ignore-errors csv /tmp/amateur_licenses.csv
psql $DATABASE_URL -c "DELETE FROM import.amateur_licenses WHERE radio_service_desc <> 'Amateur';
ALTER TABLE import.amateur_licenses RENAME TO amateur;
DROP TABLE IF EXISTS licenses.amateur;
ALTER TABLE import.amaterr SET SCHEMA licenses;
"
rm -f /tmp/licenses*
