#!/usr/bin/env bash
wget -cO /tmp/licenses.zip http://data.fcc.gov/download/license-view/fcc-license-view-data-csv-format.zip
gunzip -c /tmp/licenses.zip > /tmp/licenses.csv
# Rather than insert every damn row into the import table, first do a quick filter.
awk 'NR==1 || /Amateur/' /tmp/licenses.csv > /tmp/amateur_licenses.csv
psql $DATABASE_URL -c "DROP TABLE IF EXISTS import.amateur_licenses"
/app/bin/pgfutter_linux --ignore-errors csv /tmp/amateur_licenses.csv
psql $DATABASE_URL -c "TRUNCATE TABLE licenses; INSERT INTO licenses select * from import.amateur_licenses where radio_service_desc='Amateur'"
rm -f /tmp/licenses*
